
close all;
clc;

h_sin2bb =  [.0022823;
        -.010765;
        -.0189942;
        -.0195269;
        -.0127164;
        -.0050975;
        -.0017596;
        -.00582499;
        -.0134492;
        -.0164455;
        -.0113123;
        .000107059;
        .00946507;
        .00919206;
        -.00113415;
        -.0136399;
        -.0193547;
        -.0160719;
        -.00486039;
        .00508724;
        .00734249;
        .000880262;
        -.0118541;
        -.0200359;
        -.0210711;
        -.0160359;
        -.0103424;
        -.0137948;
        -.0215754;
        -.0265345;
        -.026134;
        -.013655;
        .00329941;
        .0157144;
        .0247854;
        .0250871;
        .0224221;
        .0220214;
        .0199585;
        .019713;
        .0172629;
        .013539;
        .0161644;
        .0245833;
        .0343161;
        .0399742;
        .0402139;
        .0361113;
        .0344097;
        .0384114;
        .0405739;
        .0375015;
        .0298062;
        .0118903;
        -.0148933;
        -.0480136;
        -.076336;
        -.0768985;
        -.0453503;
        -.00188464;
        .0186754;
        .000930592;
        -.0384536;
        -.0689958;
        -.0667909;
        -.0433212;
        -.0300989;
        -.0370603;
        -.0590123;
        -.0735325;
        -.0471073;
        .00744644;
        .068612;
        .111232;
        .0986537;
        .058502;
        .0209664;
        -.00592962;
        -.00787371;
        -.000759247;
        .000331948;
        -.000382725;
        -.00031775;
        9.34573e-5;
        -9.01241e-5;
        -.000641342;
        -.00101676;
        -.000897311;
        -.000275065;
        .000349352;
        .000351448;
        -.000323009;
        -.000974217;
        -.00103001;
        -.000436473;
        .000403975;
        .000967099;
        .000817466;
        5.04233e-5;
        -.000682881;
        -.00105098;
        -.000894036;
        -.000298564;
        .00013839;
        -.000220119;
        -.000913083;
        -.00098678;
        -.000246487;
        .00115744;
        .00225056;
        .00209313;
        .00114718;
        .000408921;
        .000440286;
        .00115373;
        .00182241;
        .00202494;
        .00175423;
        .00115433;
        .000689664;
        .000366708;
        .000159357;
        9.30144e-6;
        4.13063e-6;
        -3.98743e-5;
        -.000633551;
        -.00150708;
        -.00294477];

 h_bb = [.0222325;
        -.0139671;
        -.0305184;
        -.0307636;
        -.0101165;
        -.000200581;
        .00550817;
        -.00149264;
        -.0170492;
        -.0268676;
        -.0214635;
        .00134159;
        .0226597;
        .0225511;
        .00109679;
        -.0224108;
        -.0280385;
        -.0228094;
        -.00268563;
        .0137355;
        .0180825;
        .0111368;
        -.0149742;
        -.0294231;
        -.0306827;
        -.0160451;
        .0032811;
        -.00678058;
        -.026303;
        -.0364341;
        -.0413457;
        -.0178154;
        .0100546;
        .0190829;
        .0319895;
        .0257628;
        .0164719;
        .0208493;
        .0180724;
        .0281953;
        .0257796;
        .00913213;
        .00850601;
        .0231608;
        .0431035;
        .0528096;
        .0500973;
        .0313528;
        .0256348;
        .0451643;
        .0536033;
        .0403724;
        .0281472;
        .0119722;
        9.23611e-6;
        -.0337887;
        -.0992857;
        -.123698;
        -.0714675;
        .0238356;
        .0697147;
        .0271743;
        -.0606042;
        -.120834;
        -.0925527;
        -.0243003;
        -.00196787;
        -.0208312;
        -.0673055;
        -.115875;
        -.0792391;
        -.00596349;
        .0874122;
        .176433;
        .12259;
        .0391578;
        .00138033;
        -.0276105;
        -.00353472;
        .01858;
        .00183158;
        -.0110577;
        -.00393337;
        .00570718;
        .0029915;
        -.00199942;
        -.00130829;
        .00114979;
        .00107999;
        -.000411593;
        -.000745858;
        -.000142838;
        .000160664;
        .000110064;
        -.000227725;
        -.000354958;
        -.00034311;
        -.000254735;
        -.000147984;
        -2.7051e-7;
        1.18658e-5;
        -7.15179e-5;
        1.8272e-5;
        .000132489;
        .000585346;
        .00107692;
        .00106946;
        .00112041;
        .000995935;
        .000797515;
        .00122163;
        .0013991;
        .00106644;
        .00100282;
        .000814768;
        .000801713;
        .000838398;
        .000536345;
        .000387848;
        .000319982;
        8.47191e-5;
        -.000361454;
        -.000511269;
        -.000703714;
        -.000801431;
        -.000726675;
        -.00130935;
        -.00205656];

 h_bb2sin = [.0217461;
        -.0164974;
        -.033708;
        -.0349291;
        -.0127497;
        -.00465969;
        .000563782;
        -.00514913;
        -.0186947;
        -.0285336;
        -.0240213;
        -.00135263;
        .0207963;
        .0212745;
        .000250887;
        -.0229424;
        -.0272256;
        -.0215605;
        -.00101373;
        .0152345;
        .0190469;
        .0126293;
        -.0131939;
        -.0266963;
        -.0273435;
        -.0126104;
        .00654626;
        -.00423189;
        -.0237024;
        -.0319275;
        -.036903;
        -.0138668;
        .013459;
        .0200862;
        .0329395;
        .0266498;
        .0160463;
        .0199025;
        .0150944;
        .0256663;
        .0236577;
        .005528;
        .00469224;
        .0193236;
        .0393915;
        .0495747;
        .0475515;
        .0275647;
        .021408;
        .0431827;
        .0533126;
        .03912;
        .026313;
        .0104934;
        .00237845;
        -.0276268;
        -.0951662;
        -.122519;
        -.0705127;
        .0274033;
        .0743637;
        .0301029;
        -.0589393;
        -.119456;
        -.0895862;
        -.0202064;
        -.000919056;
        -.0213271;
        -.0652799;
        -.1139;
        -.0786366;
        -.00918063;
        .0842757;
        .178637;
        .121702;
        .0356804;
        -.000987128;
        -.0309118;
        -.00630541;
        .015878;
        -.00242786;
        -.0156923;
        -.00609566;
        .0052158;
        .000475123;
        -.00576954;
        -.00350706;
        .00084783;
        .0011167;
        -.000274508;
        .00010957;
        .0016233;
        .00264141;
        .00231896;
        .00231579;
        .00272708;
        .00288061;
        .00336748;
        .00319252;
        .00300285;
        .0030219;
        .0025936;
        .00197251;
        .00117409;
        .000869601;
        .000758443;
        .000597427;
        .000185713;
        -.000718848;
        -.00149134;
        -.00198242;
        -.00209238;
        -.00188984;
        -.00190485;
        -.00192952;
        -.00213428;
        -.00247452;
        -.00243152;
        -.00236441;
        -.00213092;
        -.00174564;
        -.00132817;
        -.00114774;
        -.00120431;
        -.00102358;
        -.000670235;
        -5.95363e-5;
        .000490485];


 h_sin = [.00611868;
        .0078714;
        .00940182;
        .0106632;
        .0116183;
        .0122381;
        .0125087;
        .0124151;
        .0119644;
        .0111676;
        .0100462;
        .00862901;
        .00696222;
        .00508823;
        .00306373;
        .000946229;
        -.00120326;
        -.00332236;
        -.00534974;
        -.00722836;
        -.00890035;
        -.0103194;
        -.0114426;
        -.0122376;
        -.0126813;
        -.0127589;
        -.0124664;
        -.0118132;
        -.0108157;
        -.00950104;
        -.00790918;
        -.00608452;
        -.00407815;
        -.00194941;
        .000243349;
        .00243289;
        .00455866;
        .00655702;
        .00836954;
        .00994616;
        .0112386;
        .0122102;
        .0128282;
        .0130787;
        .0129499;
        .0124454;
        .011578;
        .0103715;
        .00886241;
        .00708973;
        .00510801;
        .00297056;
        .00074363;
        -.00151429;
        -.00373364;
        -.00585271;
        -.00780736;
        -.00954061;
        -.0110041;
        -.0121513;
        -.0129502;
        -.0133754;
        -.0134141;
        -.0130628;
        -.0123311;
        -.0112373;
        -.00981512;
        -.00810332;
        -.00615151;
        -.00401387;
        -.00175253;
        .000567634;
        .00287872;
        .00511458;
        .00720823;
        .0090991;
        .0107315;
        .0120577;
        .0130379;
        .0136425;
        .0138519;
        .0136607;
        .0130699;
        .0120967;
        .0107705;
        .00912412;
        .00720836;
        .00507533;
        .00278774;
        .000411414;
        -.00198554;
        -.00433125;
        -.00656149;
        -.00860753;
        -.0104105;
        -.0119161;
        -.0130812;
        -.0138669;
        -.0142538;
        -.0142251;
        -.0137844;
        -.012939;
        -.0117144;
        -.0101433;
        -.00827141;
        -.00615126;
        -.00384478;
        -.00141808;
        .00105814;
        .00351379;
        .00587455;
        .00807436;
        .0100461;
        .0117331;
        .0130845;
        .014059;
        .0146295;
        .0147744;
        .0144892;
        .0137823;
        .0126686;
        .0111848;
        .00936767;
        .00727125;
        .00495444;
        .00248516;
        -6.73399e-5;
        -.00262758];

%% Question 2_4

f_s = 16000;    % 采样频率 Hz
h = flipud(h_bb);  % 或者使用 h_bb
% h = flipud(h_bb);
[H, w] = freqz(h, 1, 512, f_s); % 计算频率响应

% 找到 f = 440 Hz 对应的索引
f_target = 440;  % 目标频率 Hz
[~, idx] = min(abs(w - f_target)); % 找到最接近目标频率的索引

% 获取对应的 H 值
H_target = H(idx);       % 目标频率处的 H 值
magnitude_H = abs(H_target);         % 幅度
phase_H = angle(H_target) * 180 / pi; % 相位，转为角度

% 显示结果
disp('For H_bb(f)')
disp(['At f = ' num2str(f_target) ' Hz:']);
disp(['Magnitude = ' num2str(magnitude_H)]);
disp(['Phase (degrees) = ' num2str(phase_H)]);

% 绘图
figure('Color','white');
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)';
set(gca,'LooseInset',get(gca,'TightInset'));

figure('Color','white');
subplot(2,1,1);
plot(w/f_s, 20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Estimated Filter H(w)';
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(angle(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)';
set(gca,'LooseInset',get(gca,'TightInset'));